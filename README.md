# Authors: 
    Grace Vinothraj Arulrajah
    Shuo Zhai
    Lucas Leonhard Riehm 
    Vishwa Dolarbhai Patel 

# RNA-Seq Pipeline

This repository contains our RNA-Seq analysis pipeline built using [Nextflow](https://www.nextflow.io/) and the `nf-core` framework. The pipeline automates the processing of RNA-Seq data, starting from raw FASTQ files to generate quality control reports (MultiQC) and aligned reads.

## Features
- **Multi-tool workflow**: Uses multiple bioinformatics tools including `FastQC`, `MultiQC`, `Trim Galore`, `Fastp`, and `STAR`.
- **Scalable**: Leverages Nextflow to run on local machines or scalable cloud infrastructures.
- **Containerized**: All processes are run within Docker containers for reproducibility.
- **Configurable**: Customize the pipeline by passing different reference files and parameters through the Nextflow configuration.

## Prerequisites

1. **Nextflow**: Install Nextflow following the [installation guide](https://www.nextflow.io/docs/latest/getstarted.html).
2. **Docker**: Ensure Docker is installed and running on your machine. [installation guide](https://docs.docker.com/engine/install/debian/)

## Pipeline Structure

### `rnaseq.nf`

This file defines the main workflow:

- **Input**: The pipeline accepts a sample sheet in CSV format that lists the sample ID and paths to the paired-end FASTQ files.
- **Tools**: The following tools are used for data processing:
  - `FastQC`: For quality control of raw reads.
  - `MultiQC`: Aggregates results from FastQC.
  - `Trim Galore`/`Fastp`: Performs adapter trimming and read quality filtering.
  - `STAR`: Aligns RNA-Seq reads to the reference genome.
  
- **Key Processes**:
  - `VERSIONS`: Captures the versions of all tools used in the pipeline and outputs to `versions.txt`.
  - `QC`: Runs quality control using `FastQC` and `MultiQC`.
  - `TRIM_GALORE` or `TRIM_FASTP`: Performs adapter trimming.
  - `STAR_MAPPING`: Maps the reads using the STAR aligner.
  - `FEATURE_COUNT`: Counts the mapped reads per gene.

### `nextflow.config`

This file provides the configuration for the pipeline:

- **Default Parameters**:
  - `ref_fasta`: Path to the reference genome FASTA file.
  - `ref_gtf`: Path to the GTF annotation file.
  - `strand`: Strand-specificity (0 for unstranded, 1 for stranded, 2 for reverse stranded).
- **Resources**: CPU and memory allocations are defined for each process: (Note, fi you have 16 GB RAM, the maximum amount should be set to 15.5GB RAM)
  - `TRIM_GALORE`/`TRIM_FASTP`: 4 CPUs, 16 GB memory.
  - `STAR_MAPPING`: 3 CPUs, 8 GB memory.

## Running the Pipeline

### Input
Ensure that your sample sheet is properly formatted. The CSV should have the following columns:
```csv
sampleid,read1,read2
sample_1,/path/to/sample1_R1.fastq.gz,/path/to/sample1_R2.fastq.gz
sample_2,/path/to/sample2_R1.fastq.gz,/path/to/sample2_R2.fastq.gz
```

### Command
To run the pipeline:

For example, using docker and fastp for trimming: 
```bash
nextflow run rnaseq.nf --ref_fasta ref/chrX.fa --ref_gtf ref/chrX.gtf --strand 0 --sample_sheet ./samplesheet.csv  -resume --with_docker --use_fastp
```
For example, using docker and Trim Galore for trimming: 
```bash
nextflow run rnaseq.nf --ref_fasta ref/chrX.fa --ref_gtf ref/chrX.gtf --strand 0 --sample_sheet ./samplesheet.csv  -resume --with_docker
```


### Output
- **Quality control**: Reports generated by `FastQC` and aggregated by `MultiQC`.
- **Trimming**: Trimmed FASTQ files using `Trim Galore` or `Fastp`. Rerun QC on the trimmed results. 
- **Alignment**: Aligned reads in BAM format from the STAR aligner.
- **Feature counts**: Gene-level read counts in a table format.
